import json
import re

# File to read
input_filename = "README.md"
output_filename = "parsed_tests.json"

# Regular expressions for pattern matching
category_pattern = re.compile(r"^- \*\*(.+?)\*\*")
subcategory_pattern = re.compile(r"\*\*(.+?)\*\*")
test_item_pattern = re.compile(r"- \[ \]  (.+)")

# Data storage
parsed_data = []
current_category = None
current_subcategory = None

# Read the content of README.md
with open(input_filename, "r", encoding="utf-8") as file:
    lines = file.readlines()

# Processing the lines from README.md
for line in lines:
    line = line.strip()
    
    if not line:
        continue

    # Check for category (e.g., "CLIENT SIDE TESTING")
    category_match = category_pattern.match(line)
    if category_match:
        current_category = category_match.group(1)
        continue

    # Check for subcategory (e.g., "Test For DOM Based Cross Site Scripting")
    subcategory_match = subcategory_pattern.match(line)
    if subcategory_match:
        current_subcategory = subcategory_match.group(1)
        continue

    # Check for test items (e.g., "Try to identify DOM sinks")
    test_item_match = test_item_pattern.match(line)
    if test_item_match and current_category and current_subcategory:
        test_item = test_item_match.group(1)
        parsed_data.append({
            "name": test_item,
            "description": f"Test related to {current_subcategory}.",
            "tags": [current_category, current_subcategory],
            "comments": "",
            "recommendations": "Follow best security practices to mitigate potential risks."
        })

# Convert to JSON
json_output = json.dumps(parsed_data, indent=4)

# Save to file
with open(output_filename, "w", encoding="utf-8") as json_file:
    json_file.write(json_output)

print(f"JSON file '{output_filename}' has been generated successfully.")
